<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFFSHORE FOCUS: Engineering Pomodoro</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 3. Babel (untuk JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 4. Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Base styles */
        body { margin: 0; background-color: #0f172a; color: #e2e8f0; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICON HELPER ---
        const createLucideIcon = (iconName) => ({ color = "currentColor", size = 24, strokeWidth = 2, className, ...props }) => {
            const iconData = lucide.icons[iconName];
            if (!iconData) return null;
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className} {...props} dangerouslySetInnerHTML={{ __html: iconData.map(([tag, attrs]) => `<${tag} ${Object.entries(attrs).map(([k, v]) => `${k}="${v}"`).join(' ')}></${tag}>`).join('')}} />
            );
        };

        // Icons
        const Play = createLucideIcon('Play');
        const Pause = createLucideIcon('Pause');
        const Square = createLucideIcon('Square');
        const Anchor = createLucideIcon('Anchor');
        const CloudRain = createLucideIcon('CloudRain');
        const CloudLightning = createLucideIcon('CloudLightning');
        const Sun = createLucideIcon('Sun');
        const CloudFog = createLucideIcon('CloudFog');
        const Zap = createLucideIcon('Zap');
        const Search = createLucideIcon('Search');
        const Wind = createLucideIcon('Wind');
        const Moon = createLucideIcon('Moon');
        const Sunrise = createLucideIcon('Sunrise');
        const LifeBuoy = createLucideIcon('LifeBuoy');
        const Cloud = createLucideIcon('Cloud');
        const Waves = createLucideIcon('Waves');
        const Menu = createLucideIcon('Menu');
        const X = createLucideIcon('X');
        const VolumeX = createLucideIcon('VolumeX');
        const Hammer = createLucideIcon('Hammer');
        const Settings = createLucideIcon('Settings');
        const HardHat = createLucideIcon('HardHat');

        // --- AUDIO ENGINE ---
        class AmbientSynth {
            constructor() {
                this.ctx = null;
                this.nodes = [];
            }
            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
            }
            stop() {
                this.nodes.forEach(n => { try { n.stop(); n.disconnect(); } catch(e){} });
                this.nodes = [];
            }
            play(type) {
                this.init();
                this.stop();
                if (this.ctx.state === 'suspended') this.ctx.resume();

                const ctx = this.ctx;
                const bufferSize = 2 * ctx.sampleRate;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) { data[i] = Math.random() * 2 - 1; }

                const noise = ctx.createBufferSource();
                noise.buffer = buffer;
                noise.loop = true;
                const gain = ctx.createGain();
                const filter = ctx.createBiquadFilter();

                if (type === 'waves') {
                    filter.type = 'lowpass'; filter.frequency.value = 400; gain.gain.value = 0.15;
                    const lfo = ctx.createOscillator(); lfo.type = 'sine'; lfo.frequency.value = 0.1; 
                    const lfoGain = ctx.createGain(); lfoGain.gain.value = 300;
                    lfo.connect(lfoGain); lfoGain.connect(filter.frequency); lfo.start(); this.nodes.push(lfo);
                } else if (type === 'engine') {
                    filter.type = 'lowpass'; filter.frequency.value = 120; gain.gain.value = 0.25;
                } else if (type === 'rain') {
                    filter.type = 'lowpass'; filter.frequency.value = 800; gain.gain.value = 0.1;
                } else if (type === 'underwater') {
                    filter.type = 'lowpass'; filter.frequency.value = 200; filter.Q.value = 10; gain.gain.value = 0.3;
                } else if (type === 'wind') {
                    filter.type = 'bandpass'; filter.frequency.value = 600; filter.Q.value = 1; gain.gain.value = 0.1;
                    const lfo = ctx.createOscillator(); lfo.type = 'sine'; lfo.frequency.value = 0.2; 
                    const lfoGain = ctx.createGain(); lfoGain.gain.value = 200; 
                    lfo.connect(lfoGain); lfoGain.connect(filter.frequency); lfo.start(); this.nodes.push(lfo);
                }
                noise.connect(filter); filter.connect(gain); gain.connect(ctx.destination);
                noise.start(); this.nodes.push(noise);
            }
        }

        // --- DATA ---
        const AMBIENT_SOUNDS = [
            { id: 'mute', label: 'Mute (Silent)', icon: <VolumeX size={14}/> },
            { id: 'waves', label: 'Ocean Waves', icon: <Waves size={14}/> },
            { id: 'engine', label: 'Heavy Machinery', icon: <Settings size={14}/> },
            { id: 'rain', label: 'Rain', icon: <CloudRain size={14}/> },
            { id: 'underwater', label: 'Underwater', icon: <Anchor size={14}/> },
            { id: 'wind', label: 'High Altitude', icon: <Wind size={14}/> },
        ];

        const THEMES = [
            { id: 'MARINE', label: 'Marine Engineering', icon: <Anchor size={16}/>, color: 'text-cyan-400' },
            { id: 'CIVIL', label: 'Civil Engineering', icon: <Hammer size={16}/>, color: 'text-orange-400' },
            { id: 'MECH', label: 'Mechanical Eng.', icon: <Settings size={16}/>, color: 'text-red-400' },
        ];

        const FACT_DATABASE = {
            MARINE: [
                "Tekanan hidrostatik bertambah 1 atm setiap kedalaman 10 meter.",
                "Sistem DP (Dynamic Positioning) menjaga posisi kapal tanpa jangkar.",
                "Pipa bawah laut dilapisi beton (Concrete Weight Coating) agar stabil.",
                "Las Hyperbaric dilakukan di habitat kering di dasar laut.",
                "Stinger menjaga kelengkungan pipa agar tidak buckling saat instalasi.",
                "Anoda korban mencegah korosi pada kaki jacket platform.",
                "Kapal 'Pioneering Spirit' adalah kapal konstruksi terbesar di dunia.",
                "Teknologi 'S-Lay' membentuk kurva S, 'J-Lay' membentuk kurva J.",
                "Free Span pada pipa berbahaya karena getaran arus laut."
            ],
            CIVIL: [
                "Beton mencapai kekuatan maksimalnya setelah 28 hari pengerasan.",
                "Burj Khalifa menggunakan sistem struktur 'Buttressed Core'.",
                "Slump Test digunakan untuk mengukur kekentalan adukan beton.",
                "Pondasi Bore Pile memindahkan beban ke lapisan tanah keras.",
                "Tulangan sengkang pada balok berfungsi menahan gaya geser.",
                "Beban mati (Dead Load) adalah berat struktur itu sendiri.",
                "Tower Crane tumbuh bersama bangunan menggunakan sistem 'self-climbing'.",
                "Segregasi adalah pemisahan kerikil dari adukan beton.",
                "Retaining Wall berfungsi menahan tanah agar tidak longsor."
            ],
            MECH: [
                "Hukum Termodinamika ke-2: Entropi sistem tertutup selalu bertambah.",
                "Turbin gas bekerja berdasarkan siklus Brayton.",
                "Roda gigi (Gear) digunakan untuk mentransmisikan daya.",
                "Mesin diesel menggunakan kompresi untuk membakar bahan bakar."
            ]
        };

        const MODES = {
            WORK: { id: 'WORK', label: 'WORKING PHASE', color: 'text-amber-500' },
            SHORT_BREAK: { id: 'SHORT_BREAK', label: 'SHORT BREAK', color: 'text-cyan-400', defaultTime: 5 * 60 },
            LONG_BREAK: { id: 'LONG_BREAK', label: 'LONG BREAK', color: 'text-emerald-400', defaultTime: 15 * 60 }
        };

        const DURATION_OPTIONS = [
            { id: 10, label: '10m (RAPID)', wake: 'high' },
            { id: 15, label: '15m (EXPRESS)', wake: 'medium' },
            { id: 25, label: '25m (STD)', wake: 'low' },
        ];

        const WEATHERS = {
            SUNNY: { id: 'SUNNY', label: 'CLEAR SKY', icon: <Sun size={16} className="text-yellow-400" />, bg: 'bg-gradient-to-b from-sky-400 via-sky-300 to-sky-100', overlay: 'opacity-0' },
            OVERCAST: { id: 'OVERCAST', label: 'OVERCAST', icon: <Cloud size={16} className="text-slate-200" />, bg: 'bg-gradient-to-b from-slate-400 to-slate-300', overlay: 'opacity-10 bg-slate-500' },
            RAINY: { id: 'RAINY', label: 'LIGHT RAIN', icon: <CloudRain size={16} className="text-blue-300" />, bg: 'bg-gradient-to-b from-slate-600 to-slate-800', overlay: 'opacity-30 bg-slate-800' },
            WINDY: { id: 'WINDY', label: 'HIGH WINDS', icon: <Wind size={16} className="text-slate-100" />, bg: 'bg-gradient-to-b from-sky-600 to-slate-500', overlay: 'opacity-0' },
            FOGGY: { id: 'FOGGY', label: 'HEAVY FOG', icon: <CloudFog size={16} className="text-slate-300" />, bg: 'bg-gradient-to-b from-slate-300 to-slate-400', overlay: 'opacity-80 bg-white mix-blend-overlay' },
            SUNSET: { id: 'SUNSET', label: 'SUNSET', icon: <Sunrise size={16} className="text-orange-500" />, bg: 'bg-gradient-to-b from-indigo-800 via-purple-600 to-orange-400', overlay: 'opacity-20 bg-orange-900 mix-blend-overlay' },
            NIGHT: { id: 'NIGHT', label: 'NIGHT OPS', icon: <Moon size={16} className="text-yellow-100" />, bg: 'bg-gradient-to-b from-black via-slate-900 to-slate-800', overlay: 'opacity-60 bg-black' },
            STORMY: { id: 'STORMY', label: 'STORM SURGE', icon: <CloudLightning size={16} className="text-purple-400" />, bg: 'bg-gradient-to-b from-indigo-950 to-black', overlay: 'opacity-70 bg-black' },
        };

        // --- MAIN COMPONENT ---
        function PipelineMaster() {
            const [currentTheme, setCurrentTheme] = useState('MARINE');
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            
            const [mode, setMode] = useState('WORK');
            const [selectedWorkDuration, setSelectedWorkDuration] = useState(25);
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [totalTime, setTotalTime] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [currentSound, setCurrentSound] = useState('mute');
            const [fact, setFact] = useState(FACT_DATABASE['MARINE'][0]);
            const [weather, setWeather] = useState(WEATHERS.SUNNY);
            
            // Visual States
            const [tideLevel, setTideLevel] = useState(0);
            const [wavePath, setWavePath] = useState("");
            const [shipYOffset, setShipYOffset] = useState(0);
            const [randomEvent, setRandomEvent] = useState(null); 
            const [buoyState, setBuoyState] = useState({ active: true, x: 120, yOffset: 0, type: 'GREEN' });
            
            const audioSynth = useRef(new AmbientSynth());
            const timerRef = useRef(null);
            const weatherTimerRef = useRef(null);
            const eventTimerRef = useRef(null);
            const [visualProgress, setVisualProgress] = useState(0);

            const skylineData = useMemo(() => {
                const buildings = [];
                for(let i=0; i<15; i++) {
                    buildings.push({
                        width: 3 + Math.random() * 5, height: 5 + Math.random() * 15, margin: Math.random() * 1, color: Math.random() > 0.5 ? 'bg-slate-700' : 'bg-slate-800'
                    });
                }
                return buildings;
            }, []);

            // --- CORE LOGIC ---
            
            // Timer Functionality
            useEffect(() => {
                if (isActive && timeLeft > 0) {
                    timerRef.current = setInterval(() => {
                        setTimeLeft((prev) => prev - 1);
                    }, 1000);
                } else if (timeLeft === 0) {
                    // Timer Finished
                    clearInterval(timerRef.current);
                    setIsActive(false);
                    audioSynth.current.stop();
                    if (mode === 'WORK') {
                        switchMode('SHORT_BREAK');
                    }
                }
                return () => clearInterval(timerRef.current);
            }, [isActive, timeLeft, mode]);

            // Weather Cycle
            useEffect(() => {
                if (isActive) {
                    weatherTimerRef.current = setInterval(() => {
                        const keys = Object.keys(WEATHERS);
                        const randKey = keys[Math.floor(Math.random() * keys.length)];
                        setWeather(WEATHERS[randKey]);
                    }, 30000); 
                }
                return () => clearInterval(weatherTimerRef.current);
            }, [isActive]);

            // Events (Police)
            useEffect(() => {
                if (isActive && currentTheme === 'MARINE') {
                    eventTimerRef.current = setInterval(() => {
                        if (Math.random() < 0.3) {
                            setRandomEvent('POLICE');
                            setTimeout(() => setRandomEvent(null), 25000);
                        }
                    }, 45000);
                }
                return () => clearInterval(eventTimerRef.current);
            }, [isActive, currentTheme]);

            // Animation Loop (Physics)
            useEffect(() => {
                let animationFrame;
                const updateVisuals = () => {
                    const targetProgress = Math.max(0, Math.min(100, ((totalTime - timeLeft) / totalTime) * 100));
                    setVisualProgress(prev => {
                        const diff = targetProgress - prev;
                        return Math.abs(diff) < 0.01 ? targetProgress : prev + diff * 0.05;
                    });

                    // Marine Physics
                    if (currentTheme === 'MARINE') {
                        const tideTime = Date.now() / 3000;
                        const tide = Math.sin(tideTime) * 10; 
                        setTideLevel(tide);

                        const time = Date.now() / 1000;
                        const wavePoints = [];
                        const waveAmp = 1.5; const waveFreq = 0.1; const waveSpeed = 2;
                        for (let x = 0; x <= 100; x++) {
                            const y = Math.sin((x * waveFreq) + (time * waveSpeed)) * waveAmp;
                            wavePoints.push([x, y]);
                        }
                        setWavePath(`M 0,${wavePoints[0][1]} ` + wavePoints.map(p => `L ${p[0]},${p[1]}`).join(" ") + ` L 100,50 L 0,50 Z`);

                        const shipStart = 10; const shipEnd = 85;
                        const currentShipX = shipStart + (visualProgress / 100) * (shipEnd - shipStart);
                        setShipYOffset(Math.sin((currentShipX * waveFreq) + (time * waveSpeed)) * waveAmp);

                        setBuoyState(prev => {
                            let newX = prev.x - 0.1; 
                            let newType = prev.type;
                            if (newX < -20) {
                                newX = 120;
                                const types = ['GREEN', 'RED', 'YELLOW'];
                                newType = types[Math.floor(Math.random() * types.length)];
                            }
                            const buoyWaveY = Math.sin((newX * waveFreq) + (time * waveSpeed)) * waveAmp;
                            return { active: true, x: newX, yOffset: buoyWaveY, type: newType };
                        });
                    }
                    animationFrame = requestAnimationFrame(updateVisuals);
                };
                animationFrame = requestAnimationFrame(updateVisuals);
                return () => cancelAnimationFrame(animationFrame);
            }, [isActive, timeLeft, totalTime, visualProgress, currentTheme]);

            useEffect(() => {
                if (isActive && currentSound !== 'mute') audioSynth.current.play(currentSound);
                else audioSynth.current.stop();
                return () => audioSynth.current.stop();
            }, [isActive, currentSound]);

            const switchMode = (newModeId) => {
                // Force stop before switching
                setIsActive(false);
                setTimeout(() => {
                    setMode(newModeId);
                    const newMode = MODES[newModeId];
                    let duration = newModeId === 'WORK' ? selectedWorkDuration * 60 : newMode.defaultTime;
                    setTotalTime(duration);
                    setTimeLeft(duration);
                    
                    const themeFacts = FACT_DATABASE[currentTheme] || FACT_DATABASE['MARINE'];
                    setFact(themeFacts[Math.floor(Math.random() * themeFacts.length)]);
                    setWeather(WEATHERS.SUNNY);
                }, 10);
            };

            const toggleTimer = () => setIsActive(!isActive);
            const resetTimer = () => { if(window.confirm("Abort Mission?")) switchMode(mode); }
            const formatTime = (s) => `${Math.floor(s / 60).toString().padStart(2, '0')}:${(s % 60).toString().padStart(2, '0')}`;

            // --- RENDERERS ---
            const renderMenu = () => (
                <div className={`absolute top-0 right-0 z-50 bg-slate-900 border-l border-slate-700 h-full w-64 shadow-2xl transform transition-transform duration-300 ${isMenuOpen ? 'translate-x-0' : 'translate-x-full pointer-events-none'}`}>
                    <div className="p-4 flex justify-between items-center border-b border-slate-800">
                        <h2 className="font-bold text-white">SYSTEM CONFIG</h2>
                        <button onClick={() => setIsMenuOpen(false)}><X className="text-slate-400 hover:text-white"/></button>
                    </div>
                    <div className="p-4 space-y-6">
                        <div>
                            <h3 className="text-xs font-bold text-slate-500 mb-2 uppercase">Theme</h3>
                            <div className="space-y-2">
                                {THEMES.map(theme => (
                                    <button key={theme.id} onClick={() => { setCurrentTheme(theme.id); setIsMenuOpen(false); }} className={`w-full flex items-center gap-3 p-3 rounded text-sm font-bold transition-all ${currentTheme === theme.id ? 'bg-slate-800 text-white border border-slate-600' : 'text-slate-400 hover:bg-slate-800/50'}`}>
                                        <span className={theme.color}>{theme.icon}</span> {theme.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                        <div>
                            <h3 className="text-xs font-bold text-slate-500 mb-2 uppercase">Audio</h3>
                            <div className="space-y-1">
                                {AMBIENT_SOUNDS.map(sound => (
                                    <button key={sound.id} onClick={() => setCurrentSound(sound.id)} className={`w-full flex items-center gap-2 p-2 rounded text-xs font-mono transition-all ${currentSound === sound.id ? 'bg-cyan-900/30 text-cyan-400 border border-cyan-800' : 'text-slate-400 hover:bg-slate-800'}`}>
                                        {sound.icon} {sound.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderWeatherEffects = () => (
                <div className="absolute inset-0 z-30 pointer-events-none">
                    {weather.id === 'RAINY' && <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-60 animate-slide-down mix-blend-screen"></div>}
                    {weather.id === 'STORMY' && <><div className="absolute inset-0 bg-black/40"></div><div className="absolute inset-0 animate-lightning bg-white/20 opacity-0"></div><div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-80 animate-slide-down mix-blend-screen" style={{ animationDuration: '0.5s' }}></div></>}
                    {weather.id === 'FOGGY' && <div className="absolute inset-0 bg-white/10 backdrop-blur-[2px] animate-pulse"></div>}
                    {weather.id === 'SUNNY' && <div className="absolute top-0 right-0 w-64 h-64 bg-yellow-400/20 rounded-full blur-[100px] animate-pulse"></div>}
                </div>
            );

            const renderMarineScene = () => {
                const shipStart = 10; const shipEnd = 85;
                const currentShipPos = shipStart + (visualProgress / 100) * (shipEnd - shipStart);
                const rigX = 5; const stingerX = currentShipPos - 5; const stingerY = 60; const touchdownX = Math.max(rigX, stingerX - 15);
                const MSL = 45; const currentWaterY = MSL - tideLevel;
                const shipBaseTop = currentWaterY - 10; const finalShipTop = shipBaseTop + shipYOffset;
                const finalBuoyTop = currentWaterY - 2 + buoyState.yOffset;

                return (
                    <div className="w-full h-96 bg-slate-900/50 rounded-xl border border-white/10 relative overflow-hidden shadow-2xl backdrop-blur-sm group">
                        <div className={`absolute inset-0 transition-all duration-2000 ${weather.bg}`}></div>
                        <div className={`absolute inset-0 z-10 pointer-events-none transition-all duration-2000 ${weather.overlay}`}></div>
                        {renderWeatherEffects()}

                        {/* Distant Rig */}
                        <div className="absolute bottom-[55%] left-[75%] opacity-40 scale-50 z-0">
                            <div className="w-16 h-32 border-l-2 border-r-2 border-slate-500 relative flex flex-col justify-end">
                                <div className="absolute inset-0 border-t border-b border-slate-600 opacity-50"></div>
                                <div className="absolute top-0 w-24 -left-4 h-8 bg-slate-600 flex items-center justify-center"><div className="w-1 h-6 bg-orange-500 absolute -top-6 left-2 animate-pulse"></div></div>
                            </div>
                        </div>

                        {/* Waves */}
                        <div className="absolute left-0 right-0 w-full h-full pointer-events-none z-10" style={{ top: `${currentWaterY}%` }}>
                            <svg viewBox="0 0 100 50" preserveAspectRatio="none" className="w-full h-full overflow-visible">
                                <path d={wavePath} className={`transition-colors duration-1000 ${weather.id === 'STORMY' ? 'fill-slate-800' : 'fill-cyan-900/80'}`} />
                                <path d={wavePath.replace('L 100,50 L 0,50 Z', '')} fill="none" stroke="rgba(255,255,255,0.3)" strokeWidth="0.3" />
                            </svg>
                            <div className={`absolute top-[0%] left-0 w-full h-[200%] transition-colors duration-1000 ${weather.id === 'STORMY' ? 'bg-slate-900' : 'bg-cyan-900/80'} backdrop-blur-sm`}></div>
                        </div>

                        {/* Seabed & Pipeline (Clean - No Dashed Lines) */}
                        <div className="absolute bottom-0 left-0 right-0 h-[10%] bg-[#0b0f19] border-t border-slate-800 z-20"></div>
                        <svg className="absolute inset-0 w-full h-full z-25 pointer-events-none">
                            <defs>
                                <linearGradient id="pipeGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stopColor="#78350f" /><stop offset="100%" stopColor="#d97706" /></linearGradient>
                                <mask id="trenchMask"><rect x="0" y="0" width="100%" height="100%" fill="white" /><rect x="0" y="93%" width="100%" height="10%" fill="black" opacity="0.6" /></mask>
                            </defs>
                            <line x1={`${rigX}%`} y1="35%" x2={`${rigX}%`} y2="92%" stroke="#502005" strokeWidth="4" />
                            <line x1={`${rigX}%`} y1="92%" x2={`${touchdownX}%`} y2="92%" stroke="url(#pipeGrad)" strokeWidth="4" strokeLinecap="round" mask="url(#trenchMask)"/>
                            <path d={`M ${touchdownX}% 92% C ${touchdownX + 15}% 92%, ${stingerX - 10}% ${stingerY + 10}%, ${stingerX}% ${stingerY}%`} fill="none" stroke="#fbbf24" strokeWidth="3"/>
                        </svg>

                        {/* Rig A */}
                        <div className="absolute bottom-[10%] left-[2%] w-20 h-40 z-25 opacity-90 flex flex-col justify-end">
                            <div className="w-16 h-32 border-l-4 border-r-4 border-slate-600 bg-slate-800/20 relative">
                                <div className="absolute inset-0 border-l border-r border-slate-600 skew-x-12 opacity-50"></div>
                            </div>
                            <div className="absolute top-0 w-24 h-12 bg-slate-700 border-2 border-slate-500 rounded-sm flex items-center justify-center shadow-lg">
                                <div className="w-1 h-8 bg-red-500 absolute -top-8 left-4 animate-pulse"></div>
                                <span className="text-[8px] font-bold text-slate-300">PLATFORM A</span>
                            </div>
                        </div>

                        {/* Buoy */}
                        {buoyState.active && (
                            <div className="absolute z-15 transition-none" style={{ top: `${finalBuoyTop}%`, left: `${buoyState.x}%` }}>
                                <div className="relative flex flex-col items-center origin-bottom">
                                    <div className={`w-2 h-2 rounded-full animate-ping mb-1 shadow-[0_0_10px] ${buoyState.type === 'GREEN' ? 'bg-green-400 shadow-green-400' : buoyState.type === 'RED' ? 'bg-red-500 shadow-red-500' : 'bg-yellow-400 shadow-yellow-400'}`}></div>
                                    {buoyState.type === 'GREEN' ? <div className="w-6 h-8 bg-green-700 border-r-2 border-b-2 border-green-900"></div> :
                                     buoyState.type === 'RED' ? <div className="w-0 h-0 border-l-[12px] border-r-[12px] border-b-[24px] border-l-transparent border-r-transparent border-b-red-700"></div> :
                                     <div className="w-8 h-8 bg-yellow-500 rounded-full border-b-4 border-yellow-700 flex items-center justify-center"><div className="text-[8px] font-bold text-black">X</div></div>}
                                </div>
                                <div className="w-[2px] h-20 bg-black/20 mx-auto"></div>
                            </div>
                        )}

                        {/* Ship */}
                        <div className="absolute w-64 h-32 z-30 transition-none" style={{ left: `calc(${currentShipPos}% - 12rem)`, top: `${finalShipTop}%` }}>
                            {selectedWorkDuration === 10 ? (
                                <>
                                    <div className="absolute top-[45%] left-0 w-full h-12 bg-slate-200 border-b-4 border-slate-400 rounded-bl-[40px] shadow-xl z-20 flex items-center transform skew-x-[-10deg]">
                                        <div className="w-full h-2 bg-orange-500 absolute top-2"></div>
                                        <div className="text-[7px] font-black text-slate-800 tracking-widest ml-12 mt-4 italic">TURBO LAYER</div>
                                    </div>
                                    <div className="absolute top-[20%] left-24 w-20 h-10 bg-slate-800 rounded-t-2xl z-10 skew-x-[-15deg] border-t-2 border-orange-500"><div className="w-12 h-4 bg-cyan-400/50 absolute top-2 left-2 rounded-sm"></div></div>
                                    <div className="absolute top-[55%] right-[95%] w-16 h-4 bg-orange-600 origin-top-right rotate-[15deg] rounded-l-full"></div>
                                </>
                            ) : selectedWorkDuration === 15 ? (
                                <>
                                    <div className="absolute top-[42%] left-0 w-full h-14 bg-blue-800 border-b-4 border-blue-950 rounded-bl-3xl shadow-xl z-20 flex items-center justify-center overflow-hidden">
                                        <div className="absolute top-4 w-full h-2 bg-white"></div>
                                        <div className="text-[8px] font-bold text-white tracking-widest mt-6">EXPRESS LAY</div>
                                    </div>
                                    <div className="absolute top-[10%] left-10 w-20 h-20 bg-white border border-slate-300 rounded z-10 shadow-md flex flex-col p-1"><div className="w-full h-4 bg-slate-800 rounded-sm mb-1"></div><div className="w-full h-4 bg-blue-900/30 rounded-sm"></div></div>
                                    <div className="absolute top-[10%] right-10 w-8 h-24 bg-yellow-500 z-10 origin-bottom rotate-[-10deg]"><div className="absolute top-0 w-12 h-2 bg-yellow-600 rotate-[90deg] origin-left"></div></div>
                                    <div className="absolute top-[50%] right-[95%] w-20 h-16 border-t-4 border-l-4 border-yellow-600 rounded-tl-full bg-transparent transform rotate-12"></div>
                                </>
                            ) : (
                                <>
                                    <div className="absolute top-[45%] right-[90%] w-24 h-24 overflow-hidden origin-top-right rotate-12 z-0"><div className="w-32 h-20 border-t-4 border-l-4 border-red-700 rounded-tl-full bg-transparent transform rotate-12"></div></div>
                                    <div className="absolute top-[40%] left-0 w-full h-16 bg-red-900 border-b-4 border-red-950 rounded-b-xl shadow-xl z-20 flex items-center justify-center overflow-hidden">
                                        <div className="absolute top-2 w-full h-1 bg-yellow-400"></div>
                                        <div className="text-[9px] font-black text-white/20 tracking-[0.5em] mt-4">HEAVY LIFT VESSEL</div>
                                    </div>
                                    <div className="absolute -top-[10%] right-8 w-16 h-32 z-10 origin-bottom flex flex-col items-center"><div className="w-0 h-0 border-l-[20px] border-r-[20px] border-b-[80px] border-l-transparent border-r-transparent border-b-slate-700 relative"><div className="absolute -top-4 w-[1px] h-32 bg-black/40"></div></div><div className="w-24 h-10 bg-slate-800 absolute bottom-0 rounded-t-lg border-t border-slate-600"></div></div>
                                    <div className="absolute top-[35%] left-2 w-16 h-4 bg-green-700 border border-green-500 z-30 transform skew-x-12 shadow-md flex items-center justify-center"><span className="text-[8px] font-bold text-white transform -skew-x-12">H</span></div>
                                    <div className="absolute top-[15%] left-20 w-24 h-16 bg-white border border-slate-300 rounded-sm z-10 shadow-sm flex flex-col p-1 gap-1"><div className="w-full h-3 bg-blue-900/20"></div><div className="w-full h-3 bg-blue-900/20"></div><div className="absolute -top-3 left-9 w-1 h-3 bg-slate-600"></div><div className="absolute -top-3 left-6 w-7 h-1 bg-slate-800 animate-spin"></div></div>
                                </>
                            )}
                            {isActive && <div className="absolute top-[50%] right-[10%] z-30"><div className="w-2 h-2 bg-blue-200 rounded-full animate-ping shadow-[0_0_20px_blue]"></div></div>}
                        </div>

                        {randomEvent === 'POLICE' && (
                            <div className="absolute z-35 animate-patrol-boat" style={{ top: `${currentWaterY - 5 + shipYOffset}%` }}>
                                <div className="w-24 h-8 bg-blue-800 rounded-br-2xl flex items-center justify-center relative shadow-lg">
                                    <span className="text-[6px] text-white font-bold tracking-widest">POLICE</span>
                                    <div className="absolute -top-2 left-6 w-8 h-4 bg-white rounded-t-lg"></div>
                                    <div className="absolute -top-4 left-8 w-1 h-2 bg-red-500 animate-ping"></div>
                                    <div className="absolute -top-4 left-10 w-1 h-2 bg-blue-500 animate-ping" style={{ animationDelay: '0.1s'}}></div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const renderCivilScene = () => {
                const buildingHeight = 10 + (visualProgress / 100) * 70;
                return (
                    <div className="w-full h-96 bg-slate-900/50 rounded-xl border border-white/10 relative overflow-hidden shadow-2xl backdrop-blur-sm group">
                        <div className={`absolute inset-0 transition-all duration-2000 ${weather.bg}`}></div>
                        <div className={`absolute inset-0 z-10 pointer-events-none transition-all duration-2000 ${weather.overlay}`}></div>
                        {renderWeatherEffects()}
                        <div className="absolute bottom-0 w-full h-[15%] bg-stone-800 border-t-4 border-stone-600 z-20"></div>
                        <div className="absolute bottom-[15%] left-0 w-full h-1/3 flex items-end justify-center gap-1 opacity-20 z-0">
                            {skylineData.map((b, i) => (<div key={i} className={b.color} style={{ width: `${b.width}rem`, height: `${b.height}rem`, marginRight: `${b.margin}rem` }}></div>))}
                        </div>
                        <div className="absolute bottom-[15%] left-1/2 -translate-x-1/2 w-32 bg-sky-900/80 border-x-4 border-stone-400 z-10 transition-all duration-1000 ease-linear" style={{ height: `${buildingHeight}%` }}>
                            <div className="w-full h-full opacity-50" style={{ backgroundImage: 'linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>
                        </div>
                        <div className="absolute left-1/2 z-20 transition-all duration-1000 ease-linear" style={{ bottom: `${15 + buildingHeight}%`, marginLeft: '20px' }}>
                            <div className="w-2 h-16 bg-yellow-500 absolute bottom-0 left-0"></div><div className="w-6 h-6 bg-yellow-600 absolute top-0 -left-2"></div>
                            <div className="w-40 h-2 bg-yellow-500 absolute top-2 -left-10 origin-left animate-crane-swing"><div className="absolute right-0 w-[1px] h-12 bg-black animate-hook-move origin-top"><div className="w-6 h-4 bg-red-600 absolute bottom-0 -left-3"></div></div></div>
                            <div className="w-10 h-4 bg-stone-500 absolute top-2 -left-12"></div>
                        </div>
                        <div className="absolute bottom-[16%] z-30 animate-truck-cycle">
                            <div className="flex items-end">
                                <div className="w-8 h-6 bg-red-600 rounded-l-md relative"><div className="w-3 h-3 bg-cyan-200 absolute top-1 left-1 rounded-sm"></div></div> 
                                <div className="w-14 h-8 bg-slate-300 rounded-full border-4 border-slate-400 ml-1 -rotate-12 origin-bottom-left overflow-hidden relative"><div className="w-full h-full bg-[linear-gradient(45deg,transparent_45%,#000_50%,transparent_55%)] bg-[length:10px_10px] animate-spin-drum"></div></div> 
                                <div className="w-4 h-4 bg-black rounded-full -ml-10 -mb-2 border-2 border-gray-600"></div><div className="w-4 h-4 bg-black rounded-full ml-6 -mb-2 border-2 border-gray-600"></div> 
                            </div>
                        </div>
                        <div className="absolute bottom-[18%] z-25 animate-dump-cycle">
                            <div className="flex items-end flex-row-reverse group">
                                <div className="w-8 h-6 bg-yellow-600 rounded-r-md relative"><div className="w-3 h-3 bg-cyan-200 absolute top-1 right-1 rounded-sm"></div></div> 
                                <div className="w-14 h-7 bg-yellow-500 border-t-4 border-yellow-700 mr-1 origin-bottom-right animate-bed-tilt"></div> 
                                <div className="w-4 h-4 bg-black rounded-full -mr-10 -mb-2 border-2 border-gray-600"></div><div className="w-4 h-4 bg-black rounded-full mr-6 -mb-2 border-2 border-gray-600"></div> 
                            </div>
                        </div>
                        <div className="absolute bottom-[15%] left-[15%] z-20">
                            <div className="relative">
                                <div className="w-14 h-8 bg-orange-600 rounded-t-lg relative z-10"><div className="w-6 h-4 bg-black/50 absolute top-1 right-1 rounded-sm"></div></div>
                                <div className="w-18 h-4 bg-black rounded-full absolute -bottom-2 -left-2 border-t-2 border-gray-500"></div>
                                <div className="absolute top-4 left-2 w-16 h-3 bg-orange-500 origin-left -rotate-45 animate-boom-dig"><div className="absolute right-0 top-0 w-12 h-2 bg-orange-400 origin-right rotate-90 animate-stick-dig"><div className="absolute left-0 top-0 w-6 h-6 border-4 border-black bg-slate-800 rounded-bl-xl origin-top-right -rotate-45 animate-bucket-dig"></div></div></div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-slate-900 text-slate-200 font-sans overflow-hidden relative flex flex-col items-center selection:bg-amber-500/30">
                    <div className="absolute inset-0 z-0 bg-gradient-to-br from-slate-900 via-slate-800 to-black"></div>
                    <header className="w-full max-w-6xl z-40 p-6 flex justify-between items-center border-b border-white/5 bg-slate-900/80 backdrop-blur-md sticky top-0">
                        <div className="flex items-center gap-4">
                            <div className={`p-2 rounded border border-white/10 ${currentTheme === 'MARINE' ? 'bg-cyan-900/50 text-cyan-400' : currentTheme === 'CIVIL' ? 'bg-orange-900/50 text-orange-400' : 'bg-slate-800 text-slate-400'}`}>
                                {currentTheme === 'MARINE' && <Anchor />} {currentTheme === 'CIVIL' && <Hammer />} {currentTheme === 'MECH' && <Settings />}
                            </div>
                            <div>
                                <h1 className="text-xl font-black tracking-widest uppercase text-white drop-shadow-md">{currentTheme === 'CIVIL' ? 'CONSTRUCTION FOCUS' : 'OFFSHORE FOCUS'} <span className="text-amber-500 text-xs align-top ml-1">V7.3</span></h1>
                                <span className="text-[10px] text-white/50 tracking-[0.2em] font-mono block">{currentTheme === 'MARINE' ? 'MARINE POMODORO' : currentTheme === 'CIVIL' ? 'CONSTRUCTION POMODORO' : 'ENGINEERING POMODORO'}</span>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                            <div className="hidden md:flex items-center gap-2 text-xs font-mono text-cyan-400 bg-cyan-950/30 px-3 py-1 rounded border border-cyan-900/50">
                                {currentTheme === 'MARINE' && <><Waves size={12} /><span>TIDE: {(tideLevel > 0 ? '+' : '')}{tideLevel.toFixed(1)}m</span></>}
                                {currentTheme === 'CIVIL' && <><HardHat size={12} className="text-orange-400"/><span className="text-orange-400">PROGRESS: {Math.round(visualProgress)}%</span></>}
                            </div>
                            <button onClick={() => setIsMenuOpen(true)} className="p-2 hover:bg-slate-800 rounded transition-colors text-white"><Menu /></button>
                        </div>
                    </header>
                    {renderMenu()}
                    <main className="flex-1 w-full max-w-6xl relative z-10 px-6 py-4 flex flex-col justify-center">
                        {currentTheme === 'MARINE' && renderMarineScene()}
                        {currentTheme === 'CIVIL' && renderCivilScene()}
                        {currentTheme === 'MECH' && <div className="w-full h-96 bg-slate-800 rounded-xl border border-white/10 flex items-center justify-center flex-col text-slate-500"><Settings size={48} className="mb-4 opacity-50"/><h2 className="text-xl font-bold">THEME: MECHANICAL</h2><p>Coming Soon</p></div>}
                        <div className="w-full mt-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                            <div className="flex flex-col pl-2">
                                {mode === 'WORK' && !isActive && (
                                    <div className="flex gap-2 mb-4">
                                        {DURATION_OPTIONS.map((opt) => (
                                            <button key={opt.id} onClick={() => { setSelectedWorkDuration(opt.id); setTotalTime(opt.id*60); setTimeLeft(opt.id*60); }} className={`flex items-center gap-2 px-4 py-2 text-[10px] font-bold rounded-full transition-all border ${selectedWorkDuration === opt.id ? 'bg-amber-500 text-black border-amber-500 shadow-[0_0_15px_rgba(245,158,11,0.3)]' : 'bg-transparent text-slate-400 border-slate-700 hover:border-slate-500'}`}>
                                                {selectedWorkDuration === opt.id && <Zap size={10} className="fill-current"/>} {opt.label}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                <div className={`text-xs font-bold tracking-widest px-4 py-1.5 rounded w-fit border mb-2 flex items-center gap-2 ${MODES[mode].color} border-current bg-white/5`}>
                                    {isActive ? <div className="w-2 h-2 rounded-full bg-current animate-pulse"/> : <Square size={10} />} {MODES[mode].label}
                                </div>
                                <div className="text-8xl font-black font-mono tracking-tighter text-white drop-shadow-2xl">{formatTime(timeLeft)}</div>
                            </div>
                            <div className="flex flex-col justify-center gap-4 h-full">
                                <div className="flex gap-4 justify-end">
                                    {isActive ? (
                                        <button onClick={toggleTimer} className="flex-1 max-w-[200px] h-16 bg-rose-600 hover:bg-rose-500 text-white font-bold rounded-xl flex items-center justify-center gap-3 border-b-4 border-rose-900 active:border-b-0 active:translate-y-1 transition-all shadow-lg"><Pause size={24} className="fill-current" /> PAUSE</button>
                                    ) : (
                                        <button onClick={toggleTimer} className="flex-1 max-w-[200px] h-16 bg-amber-500 hover:bg-amber-400 text-black font-black rounded-xl flex items-center justify-center gap-3 border-b-4 border-amber-700 active:border-b-0 active:translate-y-1 transition-all shadow-lg"><Play size={24} className="fill-current" /> {timeLeft < totalTime ? 'RESUME' : 'LAUNCH'}</button>
                                    )}
                                    <button onClick={resetTimer} className="w-16 h-16 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-xl flex items-center justify-center border-b-4 border-slate-950 active:border-b-0 active:translate-y-1 transition-all"><Square size={24} className="fill-current" /></button>
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer className="w-full bg-slate-950/50 border-t border-white/5 p-4 mt-auto z-40 backdrop-blur-md">
                        <div className="max-w-6xl mx-auto flex items-start gap-4">
                            <div className="bg-cyan-900/50 p-2 rounded-lg text-cyan-400 mt-1"><Search size={16} /></div>
                            <div>
                                <h3 className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-1">ENGINEERING DATABASE</h3>
                                <p className="text-sm font-mono text-slate-300 leading-relaxed max-w-3xl">"{fact}"</p>
                            </div>
                        </div>
                    </footer>
                    <style dangerouslySetInnerHTML={{__html: `
                        @keyframes slideDown { from { background-position: 0 0; } to { background-position: 0 100%; } }
                        .animate-slide-down { animation: slideDown 1s linear infinite; }
                        @keyframes lightning { 0%, 90% { opacity: 0; } 92% { opacity: 1; } 94% { opacity: 0; } 96% { opacity: 1; } 100% { opacity: 0; } }
                        .animate-lightning { animation: lightning 5s infinite; }
                        @keyframes patrol-boat { 0% { left: -100px; } 100% { left: 110%; } }
                        .animate-patrol-boat { animation: patrol-boat 25s linear forwards; }
                        @keyframes boom-dig { 0% { transform: rotate(-45deg); } 30% { transform: rotate(-20deg); } 60% { transform: rotate(-60deg); } 100% { transform: rotate(-45deg); } }
                        .animate-boom-dig { animation: boom-dig 6s ease-in-out infinite; }
                        @keyframes stick-dig { 0% { transform: rotate(90deg); } 30% { transform: rotate(45deg); } 50% { transform: rotate(110deg); } 100% { transform: rotate(90deg); } }
                        .animate-stick-dig { animation: stick-dig 6s ease-in-out infinite; }
                        @keyframes bucket-dig { 0% { transform: rotate(-45deg); } 40% { transform: rotate(0deg); } 60% { transform: rotate(-90deg); } 100% { transform: rotate(-45deg); } }
                        .animate-bucket-dig { animation: bucket-dig 6s ease-in-out infinite; }
                        @keyframes truck-cycle { 0% { left: -20%; } 30% { left: 20%; } 70% { left: 20%; } 100% { left: 120%; } }
                        .animate-truck-cycle { animation: truck-cycle 15s ease-in-out infinite; }
                        @keyframes spin-drum { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                        .animate-spin-drum { animation: spin-drum 2s linear infinite; }
                        @keyframes dump-cycle { 0% { right: -20%; } 30% { right: 10%; } 70% { right: 10%; } 100% { right: 120%; } }
                        .animate-dump-cycle { animation: dump-cycle 18s ease-in-out infinite; }
                        @keyframes bed-tilt { 0%, 30% { transform: rotate(0deg); } 40%, 60% { transform: rotate(-30deg); } 70%, 100% { transform: rotate(0deg); } }
                        .animate-bed-tilt { animation: bed-tilt 18s ease-in-out infinite; }
                        @keyframes crane-swing { 0% { transform: rotate(0deg); } 25% { transform: rotate(-20deg); } 75% { transform: rotate(20deg); } 100% { transform: rotate(0deg); } }
                        .animate-crane-swing { animation: crane-swing 12s ease-in-out infinite; }
                    `}} />
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PipelineMaster />);
    </script>
</body>
</html>
